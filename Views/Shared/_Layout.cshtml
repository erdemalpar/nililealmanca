<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DeutschBlitz</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bootstrap CSS (Needed for Admin Modal) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body class="bg-pink-50 font-sans antialiased min-h-screen flex flex-col">
    <!-- AnimatedHeader -->
    <header class="bg-gradient-to-r from-pink-500 via-cyan-400 to-purple-700 shadow-2xl sticky top-0 z-50">
        <div class="w-full px-4 sm:px-6 lg:px-8 py-2 flex justify-between items-center">
            <!-- Sol: Logo ve Tabs -->
            <div class="flex items-center space-x-4 sm:space-x-8">
                <div class="flex-shrink-0 transition-transform duration-300 hover:scale-[3] origin-left z-50 flex flex-col items-center">
                     <img src="~/images/nil_logo_saydam3.PNG" 
                          alt="Nil Alpar ile Almanca Öğrenme" 
                          class="h-16 sm:h-24 w-auto object-contain drop-shadow-xl filter brightness-105"
                          onerror="this.onerror=null; this.src='~/images/NilAlparAlmancaLogo.jpg';" />
                     @{
                         var version = "v1.0";
                         try {
                             var versionFile = System.IO.File.ReadAllText("version.json");
                             var versionObj = System.Text.Json.JsonSerializer.Deserialize<Dictionary<string, string>>(versionFile);
                             if(versionObj != null && versionObj.ContainsKey("version")) {
                                 version = "v" + versionObj["version"];
                             }
                         } catch {}
                     }
                     <span class="text-[0.6rem] text-white/80 font-mono mt-1">@version</span>
                </div>
                <!-- Navigasyon -->
                <nav class="flex space-x-2">
                    @* Note: Removed 'text-decoration-none' of Bootstrap to keep Tailwind style if needed, but Bootstrap resets might affect. *@
                    <a asp-controller="Home" asp-action="Index" 
                       class="no-underline px-3 py-1.5 sm:px-4 sm:py-2 text-sm font-bold transition duration-200 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-300 @(ViewContext.RouteData.Values["Action"]?.ToString() == "Index" ? "bg-yellow-300 text-pink-700 shadow-xl" : "text-white hover:bg-pink-500/50")">
                        Ana Sayfa
                    </a>
                    <a asp-controller="Home" asp-action="Lessons" 
                       class="no-underline px-3 py-1.5 sm:px-4 sm:py-2 text-sm font-bold transition duration-200 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-300 @(ViewContext.RouteData.Values["Action"]?.ToString() == "Lessons" ? "bg-yellow-300 text-pink-700 shadow-xl" : "text-white hover:bg-pink-500/50")">
                        Ders İçerikleri
                    </a>
                    
                    @if (User.IsInRole("Admin"))
                    {
                        <a asp-controller="Admin" asp-action="Index" 
                           class="no-underline px-3 py-1.5 sm:px-4 sm:py-2 text-sm font-bold transition duration-200 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-300 @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Admin" ? "bg-purple-800 text-yellow-300 shadow-xl border border-yellow-400" : "bg-purple-800/80 text-white hover:bg-purple-700")">
                            Admin Paneli 🔒
                        </a>
                    }
                </nav>
            </div>

            <!-- Sağ: Puan (Client-side handled via JS mostly for now) -->
            <div class="flex items-center space-x-3">
                <div class="text-xs sm:text-sm font-semibold text-white flex items-center bg-white/10 backdrop-blur-sm px-3 sm:px-4 py-1.5 rounded-full shadow-lg border border-white/20">
                    <!-- Trophy Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2 text-cyan-300" id="level-icon"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                    <span>
                        <span class="hidden sm:inline">Puan: </span>
                        <span id="user-score" class="font-extrabold text-yellow-300 transition duration-300 drop-shadow">0</span> | 
                    </span>
                    <span class="ml-1 sm:ml-2">
                        <span class="hidden sm:inline">Seviye: </span>
                        <span id="user-level" class="font-extrabold text-cyan-200">1</span>
                    </span>
                </div>
                
                <!-- Logout Button & User Name -->
                <div class="flex items-center space-x-2">
                     @if (User.Identity != null && User.Identity.IsAuthenticated)
                    {
                        <span class="text-white text-xs sm:text-sm font-semibold hidden sm:inline-block bg-white/20 px-3 py-1 rounded-full">
                            Hoş geldin, @User.Identity?.Name
                        </span>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="inline">
                            <button type="submit" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition duration-200 shadow-md border-0" title="Çıkış Yap">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                            </button>
                        </form>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-full transition duration-200 shadow-md no-underline text-sm font-bold">Giriş Yap</a>
                    }
                </div>
            </div>
        </div>
    </header>

    <main role="main" class="flex-grow w-full py-4 lg:py-8">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="bg-purple-900 text-white py-6 border-t border-pink-700 w-full mt-8">
        <div class="w-full px-4 sm:px-6 lg:px-8 mx-auto text-center">
            <p class="mb-1 text-xs font-light text-cyan-300">Tasarım Nilalpar tarafından yapılmıştır.</p>
            <p class="mb-2 text-xs font-light">&copy; @DateTime.Now.Year DeutschBlitz Eğlence Dünyası.</p>
            <div class="flex justify-center space-x-4 text-xs opacity-80">
                <a href="@Url.Action("Lessons", "Home")" class="hover:text-yellow-400 no-underline">Dersler</a>
                <a href="@Url.Action("Index", "Home")#kelimeler" class="hover:text-yellow-400 no-underline">Kelimeler</a>
                <a href="@Url.Action("Index", "Home")#sınav" class="hover:text-yellow-400 no-underline">Sınav</a>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <!-- SweetAlert2 Library -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // Custom Theme for DeutschBlitz
        const SwalTheme = Swal.mixin({
            confirmButtonColors: '#d63384', // Pink-600
            cancelButtonColor: '#6c757d',
            customClass: {
                popup: 'rounded-3xl border-4 border-purple-200 shadow-2xl',
                title: 'text-purple-900 font-extrabold font-sans',
                confirmButton: 'bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-2 px-6 rounded-xl shadow-lg hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition-all border-0',
                cancelButton: 'bg-gray-500 text-white font-bold py-2 px-6 rounded-xl shadow-lg hover:bg-gray-600 transform hover:scale-105 transition-all border-0'
            },
            buttonsStyling: false
        });

        // Global function to show alerts easily
        window.showAlert = function(title, text, icon = 'success') {
            SwalTheme.fire({
                title: title,
                text: text,
                icon: icon,
                confirmButtonText: 'Tamam! 👍'
            });
        };

        // Handle TempData messages from Server
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
            document.addEventListener('DOMContentLoaded', function() {
                SwalTheme.fire({
                    title: 'Harika!',
                    text: '@TempData["SuccessMessage"]',
                    icon: 'success',
                    confirmButtonText: 'Süper! 🎉'
                });
            });
            </text>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <text>
            document.addEventListener('DOMContentLoaded', function() {
                SwalTheme.fire({
                    title: 'Ops!',
                    text: '@TempData["ErrorMessage"]',
                    icon: 'error',
                    confirmButtonText: 'Tamam 😔'
                });
            });
            </text>
        }
    </script>
    
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
